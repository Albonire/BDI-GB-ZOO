<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ZOO-BDI</title>
<!-- Bootstrap CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Libre+Baskerville:wght@400;700&family=Source+Sans+Pro:wght@400;700&display=swap" rel="stylesheet">
<style>
:root {
  --primary-bg: #E9E6E1;
  --card-bg: #f8f9fa;
  --text-color: #211D1E;
  --accent-color: #8fbc8f;
  --hover-color: #7caa7c;
  --danger-color: #cc6666;
  --danger-hover: #bb5555;
  --almost-black: #1a1a1a;
  --dark-primary-bg: #121212;
  --dark-card-bg: #1e1e1e;
  --dark-text-color: #e0e0e0;
  --dark-accent-color: #6b8e6b;
  --dark-hover-color: #597959;
  --dark-border-color: #444;
  --dark-modal-bg: #2c2c2c;
  --subtle-hover-bg: rgba(255, 255, 255, 0.05);
}

body {
  font-family: 'Source Sans Pro', sans-serif;
  background-color: var(--primary-bg);
  color: var(--text-color);
  transition: background-color 0.3s, color 0.3s;
}

.navbar {
  background-color: var(--almost-black);
}

.carousel-item {
  height: 50vh;
  min-height: 400px;
  background-size: cover;
  background-position: center;
  position: relative;
}

.carousel-caption {
  background: linear-gradient(to bottom, rgba(0,0,0,0.8), rgba(0,0,0,0.4));
  padding: 1.5rem;
  border-radius: 0.5rem;
}

.carousel-caption h2, .carousel-caption p {
  color: white !important;
}

.chinese-symbol {
  font-size: 2rem;
  position: absolute;
  opacity: 0.5;
  color: white;
  text-shadow: 0 0 5px black;
}

.card {
  background-color: var(--card-bg);
  border: 1px solid #ddd;
  transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.card:hover {
  transform: translateY(-5px);
  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
  z-index: 10;
}

.card-img-top {
  width: 150px;
  height: 150px;
  object-fit: cover;
  margin: 20px auto;
  border-radius: 50%;
  border: 4px solid var(--text-color);
}

.btn-primary {
  background-color: var(--accent-color);
  border-color: var(--accent-color);
}

.btn-primary:hover {
  background-color: var(--hover-color);
  border-color: var(--hover-color);
}

.btn-danger {
  background-color: var(--danger-color);
  border-color: var(--danger-color);
}

.btn-danger:hover {
  background-color: var(--danger-hover);
  border-color: var(--danger-hover);
}

h1, h2, h3, h4, h5, h6 {
  font-family: 'Libre Baskerville', serif;
  color: var(--text-color);
  font-weight: 700;
}

/* Dark Mode Styles */
body.dark-mode {
  background-color: var(--dark-primary-bg);
  color: var(--dark-text-color);
}

.dark-mode .card {
  background-color: var(--dark-card-bg);
  color: var(--dark-text-color);
  border-color: var(--dark-border-color);
}

.dark-mode .card-img-top {
  border-color: var(--dark-accent-color);
}

.dark-mode h1, .dark-mode h2, .dark-mode h3, .dark-mode h4, .dark-mode h5, .dark-mode h6 {
  color: var(--dark-text-color);
}

.dark-mode .dropdown-menu {
  background-color: var(--dark-card-bg);
  border-color: var(--dark-border-color);
}

.dark-mode .dropdown-item {
  color: var(--dark-text-color);
}

.dark-mode .dropdown-item:hover {
  background-color: var(--dark-hover-color);
}

.dark-mode .modal-content {
    background-color: var(--dark-modal-bg);
    color: var(--dark-text-color);
    border-color: var(--dark-border-color);
}
.dark-mode .modal-header, .dark-mode .modal-footer {
    border-bottom-color: var(--dark-border-color);
    border-top-color: var(--dark-border-color);
}

.dark-mode .form-control, .dark-mode .form-select {
    background-color: var(--dark-card-bg);
    color: var(--dark-text-color);
    border-color: var(--dark-border-color);
}
.dark-mode .form-control:focus, .dark-mode .form-select:focus {
    background-color: var(--dark-card-bg);
    color: var(--dark-text-color);
    border-color: var(--dark-accent-color);
    box-shadow: 0 0 0 0.25rem rgba(107, 142, 107, 0.5);
}
.dark-mode .btn-close {
    filter: invert(1) grayscale(100%) brightness(200%);
}
.dark-mode .input-group-text {
    background-color: var(--dark-card-bg);
    border-color: var(--dark-border-color);
    color: var(--dark-text-color);
}


/* --- Custom Table Styles --- */
.table-responsive {
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
}
.table thead th {
  background-color: var(--accent-color);
  color: #fff;
  font-weight: 700;
  border-bottom: 2px solid var(--hover-color);
  font-size: 1.08rem;
  vertical-align: middle;
}
.table tbody tr {
    transition: background-color 0.2s ease-in-out;
}
.table tbody tr:hover {
  background-color: #f1f1f1;
}
.table td {
    vertical-align: middle;
}
.btn-action {
    padding: 0.25rem 0.5rem;
    font-size: 0.9rem;
}

/* Dark Mode Table Styles */
.dark-mode .table {
  color: var(--dark-text-color);
  background-color: var(--dark-card-bg);
}
.dark-mode .table thead th {
  background-color: var(--dark-accent-color);
  color: #fff;
  border-color: var(--dark-hover-color);
}
.dark-mode .table tbody tr {
  background-color: var(--dark-card-bg);
  border-bottom: 1px solid var(--dark-border-color);
}
.dark-mode .table tbody tr:hover {
  background-color: var(--subtle-hover-bg) !important;
}
.dark-mode .table td, .dark-mode .table th {
    border-color: var(--dark-border-color);
}

/* --- ESTILOS PARA EL CONTADOR DE RESULTADOS EN MODO OSCURO --- */
.dark-mode .text-muted {
    color: var(--dark-text-color) !important;
}

.dark-mode #contadorResultados {
    color: var(--dark-text-color) !important;
}

/* --- ANULAR CLASE TEXT-MUTED EN MODO OSCURO --- */
.dark-mode .text-muted {
    color: #e0e0e0 !important;
}

/* --- ESTILOS PARA ICONOS DE GITHUB EN MODO OSCURO --- */
.dark-mode .btn-outline-dark {
    color: #e0e0e0 !important;
    border-color: #e0e0e0 !important;
}

.dark-mode .btn-outline-dark:hover {
    color: #1a1a1a !important;
    background-color: #e0e0e0 !important;
    border-color: #e0e0e0 !important;
}

/* --- ICONOS DE GITHUB ESPECÍFICAMENTE --- */
.dark-mode .btn-outline-dark .bi-github {
    color: #e0e0e0 !important;
}

.dark-mode .btn-outline-dark:hover .bi-github {
    color: #1a1a1a !important;
}
</style>
</head>
<body class="dark-mode">
    <!-- Navigation bar-->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container-fluid px-4">
            <a class="navbar-brand ms-3" href="#">
                <img src="https://github.com/Albonire/BDI-GB-ZOO/blob/main/frontend/logoback.png?raw=true" alt="Logo" width="30" height="28"> ZOO-BDI
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item"><a class="nav-link" href="#introCarousel" data-lang="nav-home">Home</a></li>
                    <li class="nav-item"><a class="nav-link" href="#baseDatos" data-lang="nav-database">Database</a></li>
                    <li class="nav-item"><a class="nav-link" href="#equipo" data-lang="nav-team">Team</a></li>
                </ul>
                <div class="dropdown ms-lg-3">
                    <button class="btn btn-outline-light" type="button" id="menuButton" data-bs-toggle="dropdown" aria-expanded="false" title="Menu">
                        <i class="bi bi-list"></i>
                    </button>
                    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="menuButton">
                        <li><button class="dropdown-item" type="button" id="toggleLanguage"><i class="bi bi-translate"></i> <span data-lang="language">Language</span></button></li>
                        <li><button class="dropdown-item" type="button" id="toggleTheme"><i class="bi bi-moon-stars-fill" id="themeIcon"></i> <span data-lang="theme">Theme</span></button></li>
                    </ul>
                </div>
            </div>
        </div>
    </nav>

    <!-- Slider -->
    <div id="introCarousel" class="carousel slide mb-4" data-bs-ride="carousel" data-bs-interval="3000" data-bs-pause="hover">
        <div class="carousel-inner">
            <div class="carousel-item active" style="background-image: url('https://cdn.pixabay.com/photo/2014/05/21/20/58/flock-of-birds-350290_1280.jpg');">
                <span class="chinese-symbol" style="top: 20px; left: 20px;">和</span><span class="chinese-symbol" style="bottom: 20px; right: 20px;">平</span>
                <div class="d-flex h-100 align-items-center justify-content-center">
                    <div class="carousel-caption">
                        <h2 data-lang="welcome-title">Welcome to ZOO-BDI</h2>
                        <p data-lang="welcome-subtitle">Discover the world of nature</p>
                    </div>
                </div>
            </div>
            <div class="carousel-item" style="background-image: url('https://cdn.pixabay.com/photo/2024/02/17/15/14/birds-8579528_960_720.jpg');">
                <span class="chinese-symbol" style="top: 50px; left: 50px;">生</span><span class="chinese-symbol" style="bottom: 30px; right: 30px;">命</span>
                <div class="d-flex h-100 align-items-center justify-content-center">
                    <div class="carousel-caption">
                        <h2 data-lang="manage-title">Easily manage your animals</h2>
                        <p data-lang="manage-subtitle">Intuitive and modern administration</p>
                    </div>
                </div>
            </div>
            <div class="carousel-item" style="background-image: url('https://cdn.pixabay.com/photo/2023/05/24/18/32/ladybug-8015502_960_720.jpg');">
                <span class="chinese-symbol" style="top: 40px; right: 40px;">自</span><span class="chinese-symbol" style="bottom: 20px; left: 20px;">然</span>
                <div class="d-flex h-100 align-items-center justify-content-center">
                    <div class="carousel-caption">
                        <h2 data-lang="explore-title">Explore the zoo database</h2>
                        <p data-lang="explore-subtitle">Detailed and updated information</p>
                    </div>
                </div>
            </div>
        </div>
        <button class="carousel-control-prev" type="button" data-bs-target="#introCarousel" data-bs-slide="prev" title="Previous"><span class="carousel-control-prev-icon" aria-hidden="true"></span><span class="visually-hidden" data-lang="carousel-prev">Previous</span></button>
        <button class="carousel-control-next" type="button" data-bs-target="#introCarousel" data-bs-slide="next" title="Next"><span class="carousel-control-next-icon" aria-hidden="true"></span><span class="visually-hidden" data-lang="carousel-next">Next</span></button>
    </div>

    <!-- Database Section -->
    <div id="baseDatos" class="container my-5">
        <h2 class="text-center mb-4" data-lang="database-title">Zoo Database <img src="https://www.postgresql.org/media/img/about/press/elephant.png" alt="Postgres" width="40" height="40"></h2>
        <div class="row justify-content-center g-4">
            <div class="col-lg-4 col-md-6">
                <div class="card h-100 text-center">
                    <div class="card-body d-flex flex-column">
                        <i class="bi bi-plus-circle-dotted fs-1 mb-3 text-primary"></i>
                        <h5 class="card-title" data-lang="animal-register-title">Animal Registration</h5>
                        <p class="card-text" data-lang="animal-register-text">Add a new animal to the zoo's database.</p>
                        <button type="button" class="btn btn-primary w-100 mt-auto" data-bs-toggle="modal" data-bs-target="#modalRegistrarAnimal" data-lang="animal-register-button">Register Animal</button>
                    </div>
                </div>
            </div>
            <div class="col-lg-4 col-md-6">
                <div class="card h-100 text-center">
                    <div class="card-body d-flex flex-column">
                        <i class="bi bi-arrow-clockwise fs-1 mb-3 text-primary"></i>
                        <h5 class="card-title" data-lang="animal-query-title">Reload List</h5>
                        <p class="card-text" data-lang="animal-query-text">Reload the list to see the most recent updates.</p>
                        <button type="button" class="btn btn-primary w-100 mt-auto" onclick="refrescarTablaAnimales(1)" data-lang="animal-query-button">Reload</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Animal Table -->
    <div class="container my-5">
      <h3 data-lang="animal-list-title">Animal List</h3>
      <div class="row mb-3">
        <div class="col-md-8">
          <div class="input-group">
            <span class="input-group-text"><i class="bi bi-search"></i></span>
            <input type="text" class="form-control" id="buscarAnimal" data-lang-placeholder="search-placeholder" onkeyup="buscarConDebounce()">
            <button class="btn btn-outline-secondary" type="button" onclick="limpiarBusqueda()" data-lang="clear-search-button">
              <i class="bi bi-x-circle"></i> <span data-lang="clear-button-text">Clear</span>
            </button>
          </div>
        </div>
        <div class="col-md-4 text-md-end pt-2 pt-md-0">
          <span class="text-muted" id="contadorResultados"></span>
        </div>
      </div>
      
      <div class="table-responsive">
          <table class="table table-striped" id="tablaAnimales">
            <thead>
              <tr>
                <th data-lang="table-id">ID</th>
                <th data-lang="table-name">Name</th>
                <th data-lang="table-birthdate">Birth Date</th>
                <th data-lang="table-keeper">Keeper</th>
                <th data-lang="table-habitat">Habitat</th>
                <th data-lang="table-species">Species</th>
                <th data-lang="table-actions">Actions</th>
              </tr>
            </thead>
            <tbody>
              <!-- Animals will be inserted here by JavaScript -->
            </tbody>
          </table>
      </div>
      <div id="paginacionAnimales"></div>
    </div>

    <!-- Team Section -->
    <section id="equipo" class="py-5">
        <div class="container text-center">
            <h2 class="mb-4" data-lang="team-title">Our Team</h2>
            <div class="row g-4 justify-content-center">
                <div class="col-md-4 col-lg-3">
                    <div class="card">
                        <img src="https://github.com/Albonire/BDI-GB-ZOO/blob/main/frontend/img/anderson.jpg?raw=true" class="card-img-top" alt="Team member photo">
                        <div class="card-body">
                            <h5 class="card-title" data-lang="member-1-name">Anderson González</h5>
                            <p class="card-text" data-lang="role-product-owner">Product Owner & Developer/p>
                            <div class="d-flex justify-content-center">
                                <a href="https://www.linkedin.com/in/anderson-gonzaleza21/" class="btn btn-outline-primary mx-1" target="_blank"><i class="bi bi-linkedin"></i></a>
                                <a href="https://github.com/Albonire" class="btn btn-outline-dark mx-1" target="_blank"><i class="bi bi-github"></i></a>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-4 col-lg-3">
                    <div class="card">
                        <img src="https://github.com/Albonire/BDI-GB-ZOO/blob/main/frontend/img/mateo.jpg?raw=true" class="card-img-top" alt="Team member photo">
                        <div class="card-body">
                            <h5 class="card-title" data-lang="member-2-name">Mateo Orduz</h5>
                            <p class="card-text" data-lang="role-scrum-master">Scrum Master</p>
                            <div class="d-flex justify-content-center">
                                <a href="https://github.com/mateo739" class="btn btn-outline-dark mx-1" target="_blank"><i class="bi bi-github"></i></a>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-4 col-lg-3">
                    <div class="card">
                        <img src="https://github.com/Albonire/BDI-GB-ZOO/blob/main/frontend/img/kevin.png?raw=true" class="card-img-top" alt="Team member photo">
                        <div class="card-body">
                            <h5 class="card-title" data-lang="member-3-name">Kevin Madrid</h5>
                            <p class="card-text" data-lang="role-dev-team">Development Team</p>
                            <div class="d-flex justify-content-center">
                                <a href="https://github.com/Kevin698-star" class="btn btn-outline-dark mx-1" target="_blank"><i class="bi bi-github"></i></a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Modals -->
    <!-- Register Animal Modal -->
    <div class="modal fade" id="modalRegistrarAnimal" tabindex="-1" aria-labelledby="modalRegistrarAnimalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="modalRegistrarAnimalLabel" data-lang="modal-register-title">Register Animal</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <form id="formRegistrarAnimal">
              <div id="mensajeRegistrarAnimal" class="mb-3"></div>
              <div class="mb-3"><label for="nombreAnimal" class="form-label" data-lang="form-name">Name</label><input type="text" class="form-control" id="nombreAnimal" required></div>
              <div class="mb-3"><label for="fechaNacimientoAnimal" class="form-label" data-lang="form-birthdate">Birth Date</label><input type="date" class="form-control" id="fechaNacimientoAnimal" required></div>
              <div class="mb-3"><label for="cuidadorAnimal" class="form-label" data-lang="form-keeper">Keeper</label><select class="form-select" id="cuidadorAnimal"><option value="" data-lang="select-keeper">Select a keeper...</option></select></div>
              <div class="mb-3"><label for="habitatAnimal" class="form-label" data-lang="form-habitat">Habitat</label><select class="form-select" id="habitatAnimal"><option value="" data-lang="select-habitat">Select a habitat...</option></select></div>
              <div class="mb-3"><label for="especieAnimal" class="form-label" data-lang="form-species">Species</label><select class="form-select" id="especieAnimal"><option value="" data-lang="select-species">Select a species...</option></select></div>
              <button type="submit" class="btn btn-primary w-100" data-lang="form-register-btn">Register</button>
            </form>
          </div>
        </div>
      </div>
    </div>

    <!-- Update Animal Modal -->
    <div class="modal fade" id="modalActualizarAnimal" tabindex="-1" aria-labelledby="modalActualizarAnimalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="modalActualizarAnimalLabel" data-lang="modal-update-title">Update Animal</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <form id="formActualizarAnimal">
                <input type="hidden" id="idActualizarAnimal">
                <div id="mensajeActualizarAnimal" class="mb-3"></div>
                <div class="mb-3"><label for="nombreActualizarAnimal" class="form-label" data-lang="form-name">Name</label><input type="text" class="form-control" id="nombreActualizarAnimal"></div>
                <div class="mb-3"><label for="fechaActualizarNacimientoAnimal" class="form-label" data-lang="form-birthdate">Birth Date</label><input type="date" class="form-control" id="fechaActualizarNacimientoAnimal"></div>
                <div class="mb-3"><label for="cuidadorActualizarAnimal" class="form-label" data-lang="form-keeper">Keeper</label><select class="form-select" id="cuidadorActualizarAnimal"><option value="" data-lang="select-keeper">Select a keeper...</option></select></div>
                <div class="mb-3"><label for="habitatActualizarAnimal" class="form-label" data-lang="form-habitat">Habitat</label><select class="form-select" id="habitatActualizarAnimal"><option value="" data-lang="select-habitat">Select a habitat...</option></select></div>
                <div class="mb-3"><label for="especieActualizarAnimal" class="form-label" data-lang="form-species">Species</label><select class="form-select" id="especieActualizarAnimal"><option value="" data-lang="select-species">Select a species...</option></select></div>
                <button type="submit" class="btn btn-primary w-100" data-lang="form-update-btn">Update</button>
            </form>
          </div>
        </div>
      </div>
    </div>

    <!-- Delete Animal Modal -->
    <div class="modal fade" id="modalEliminarAnimal" tabindex="-1" aria-labelledby="modalEliminarAnimalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="modalEliminarAnimalLabel" data-lang="modal-delete-title">Delete Animal</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div id="mensajeEliminarAnimal" class="mb-3"></div>
            <p id="confirmarEliminarTexto"></p>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" data-lang="form-cancel-btn">Cancel</button>
            <button type="button" class="btn btn-danger" id="btnConfirmarEliminar" data-lang="form-delete-btn">Delete</button>
          </div>
        </div>
      </div>
    </div>


    <!-- Bootstrap JS and Popper.js -->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js"></script>
    <script>
    // --- Translations Dictionary ---
    const translations = {
        en: {
            "nav-home": "Home", "nav-database": "Database", "nav-team": "Team", "language": "Language", "theme": "Theme", "welcome-title": "Welcome to ZOO-BDI", "welcome-subtitle": "Discover the world of nature", "manage-title": "Easily manage your animals", "manage-subtitle": "Intuitive and modern administration", "explore-title": "Explore the zoo database", "explore-subtitle": "Detailed and updated information", "database-title": "Zoo Database", "animal-register-title": "Animal Registration", "animal-register-text": "Add a new animal to the zoo's database.", "animal-register-button": "Register Animal", "animal-query-title": "Reload List", "animal-query-text": "Reload the list to see the most recent updates.", "animal-query-button": "Reload", "animal-list-title": "Animal List", "search-placeholder": "Search by name, keeper or species...", "clear-search-button": "Clear", "clear-button-text": "Clear", "table-id": "ID", "table-name": "Name", "table-birthdate": "Birth Date", "table-keeper": "Keeper", "table-habitat": "Habitat", "table-species": "Species", "table-actions": "Actions", "team-title": "Our Team", "member-1-name": "Anderson González", "role-product-owner": "Product Owner & Developer", "member-2-name": "Mateo Orduz", "role-scrum-master": "Scrum Master", "member-3-name": "Kevin Madrid", "role-dev-team": "Development Team", "carousel-prev": "Previous", "carousel-next": "Next", "modal-register-title": "Register Animal", "form-name": "Name", "form-birthdate": "Birth Date", "form-keeper": "Keeper", "form-habitat": "Habitat", "form-species": "Species", "select-keeper": "Select a keeper...", "select-habitat": "Select a habitat...", "select-species": "Select a species...", "form-register-btn": "Register", "modal-update-title": "Update Animal", "form-update-btn": "Update", "modal-delete-title": "Delete Animal", "form-cancel-btn": "Cancel", "form-delete-btn": "Delete", "delete-confirm-text": "Are you sure you want to delete", "results-found": "result(s) found", "total-animals": "Total animals", "counter-total": "Total animals", "counter-results": "result(s) found"
        },
        es: {
            "nav-home": "Inicio", "nav-database": "Base de Datos", "nav-team": "Equipo", "language": "Idioma", "theme": "Tema", "welcome-title": "Bienvenidos a ZOO-BDI", "welcome-subtitle": "Descubre el mundo de la naturaleza", "manage-title": "Gestiona tus animales fácilmente", "manage-subtitle": "Administración intuitiva y moderna", "explore-title": "Explora la base de datos del zoológico", "explore-subtitle": "Información detallada y actualizada", "database-title": "Base de Datos del Zoológico", "animal-register-title": "Registro de Animales", "animal-register-text": "Añade un nuevo animal a la base de datos.", "animal-register-button": "Registrar Animal", "animal-query-title": "Recargar Lista", "animal-query-text": "Recarga la lista para ver los datos más recientes.", "animal-query-button": "Recargar", "animal-list-title": "Lista de Animales", "search-placeholder": "Buscar por nombre, cuidador o especie...", "clear-search-button": "Limpiar", "clear-button-text": "Limpiar", "table-id": "ID", "table-name": "Nombre", "table-birthdate": "Fecha de Nacimiento", "table-keeper": "Cuidador", "table-habitat": "Hábitat", "table-species": "Especie", "table-actions": "Acciones", "team-title": "Nuestro Equipo", "member-1-name": "Anderson González", "role-product-owner": "Product Owner & Developer", "member-2-name": "Mateo Orduz", "role-scrum-master": "Scrum Master", "member-3-name": "Kevin Madrid", "role-dev-team": "Equipo de Desarrollo", "carousel-prev": "Anterior", "carousel-next": "Siguiente", "modal-register-title": "Registrar Animal", "form-name": "Nombre", "form-birthdate": "Fecha de Nacimiento", "form-keeper": "Cuidador", "form-habitat": "Hábitat", "form-species": "Especie", "select-keeper": "Seleccionar cuidador...", "select-habitat": "Seleccionar hábitat...", "select-species": "Seleccionar especie...", "form-register-btn": "Registrar", "modal-update-title": "Actualizar Animal", "form-update-btn": "Actualizar", "modal-delete-title": "Eliminar Animal", "form-cancel-btn": "Cancelar", "form-delete-btn": "Eliminar", "delete-confirm-text": "¿Estás seguro de que quieres eliminar a", "results-found": "resultado(s) encontrado(s)", "total-animals": "Animales en total", "counter-total": "Animales en total", "counter-results": "resultado(s) encontrado(s)"
        }
    };

    let currentLang = 'en';
    const API_BASE_URL = 'http://localhost:8000';

    // --- Core Functions ---
    function updateLanguage() {
        document.querySelectorAll('[data-lang]').forEach(el => {
            const key = el.getAttribute('data-lang');
            if (translations[currentLang][key]) {
                el.textContent = translations[currentLang][key];
            }
        });
        document.querySelectorAll('[data-lang-placeholder]').forEach(el => {
            const key = el.getAttribute('data-lang-placeholder');
            if (translations[currentLang][key]) {
                el.placeholder = translations[currentLang][key];
            }
        });
    }

    function toggleTheme() {
        document.body.classList.toggle('dark-mode');
        const isDarkMode = document.body.classList.contains('dark-mode');
        localStorage.setItem('theme', isDarkMode ? 'dark' : 'light');
        const themeIcon = document.getElementById('themeIcon');
        themeIcon.classList.toggle('bi-sun-fill', !isDarkMode);
        themeIcon.classList.toggle('bi-moon-stars-fill', isDarkMode);
    }
    
    function showMessage(elementId, message, type = 'success') {
        const messageEl = document.getElementById(elementId);
        messageEl.innerHTML = `<div class="alert alert-${type}" role="alert">${message}</div>`;
        setTimeout(() => { messageEl.innerHTML = ''; }, 3000);
    }

    // --- API & Data Handling ---
    let todosLosAnimales = [], animalesFiltrados = [];
    let cuidadoresData = [], especiesData = [], habitatsData = [];
    let paginaActual = 1, pageSize = 10, totalPaginas = 1;
    let timeoutBusqueda = null;

    async function fetchFromAPI(endpoint) {
        try {
            const response = await fetch(`${API_BASE_URL}${endpoint}`);
            if (!response.ok) throw new Error(`Error fetching ${endpoint}`);
            const data = await response.json();
            return data.items || [];
        } catch (error) {
            console.error(error);
            return [];
        }
    }

    async function cargarDatosReferencia() {
        [cuidadoresData, especiesData, habitatsData] = await Promise.all([
            fetchFromAPI('/cuidadores'),
            fetchFromAPI('/especies'),
            fetchFromAPI('/habitats')
        ]);
    }

    function populateSelect(selectId, data, placeholderKey) {
        const select = document.getElementById(selectId);
        select.innerHTML = `<option value="">${translations[currentLang][placeholderKey]}</option>`;
        data.forEach(item => {
            select.innerHTML += `<option value="${item.id}">${item.nombre}</option>`;
        });
    }
    
    function refrescarTablaAnimales(page = 1) {
        fetchFromAPI('/animales?page=1&page_size=1000').then(data => {
            todosLosAnimales = data;
            paginaActual = page;
            filtrarAnimales();
        });
    }

    function filtrarAnimales() {
        const busqueda = document.getElementById('buscarAnimal').value.toLowerCase().trim();
        if (busqueda === '') {
            animalesFiltrados = [...todosLosAnimales];
        } else {
            animalesFiltrados = todosLosAnimales.filter(animal => {
                const nombre = (animal.nombre || '').toLowerCase();
                const cuidador = (obtenerNombrePorId(animal.cuidador_id, cuidadoresData) || '').toLowerCase();
                const especie = (obtenerNombrePorId(animal.especie_id, especiesData) || '').toLowerCase();
                return nombre.includes(busqueda) || cuidador.includes(busqueda) || especie.includes(busqueda);
            });
        }
        totalPaginas = Math.ceil(animalesFiltrados.length / pageSize);
        if (paginaActual > totalPaginas) paginaActual = totalPaginas || 1;
        
        const inicio = (paginaActual - 1) * pageSize;
        const fin = inicio + pageSize;
        mostrarAnimalesEnTabla(animalesFiltrados.slice(inicio, fin));
        actualizarContadorResultados(animalesFiltrados.length, busqueda !== '');
        renderPaginacion();
    }
    
    function buscarConDebounce() {
        clearTimeout(timeoutBusqueda);
        timeoutBusqueda = setTimeout(() => {
            paginaActual = 1; // Reset to first page on new search
            filtrarAnimales();
        }, 300);
    }

    function limpiarBusqueda() {
        document.getElementById('buscarAnimal').value = '';
        paginaActual = 1;
        filtrarAnimales();
    }
    
    // --- UI Rendering ---
    function obtenerNombrePorId(id, data) {
        if (!id || !data) return 'N/A';
        const item = data.find(i => i.id === id);
        return item ? item.nombre : `ID: ${id}`;
    }

    function mostrarAnimalesEnTabla(animales) {
        const tablaBody = document.getElementById('tablaAnimales').querySelector('tbody');
        tablaBody.innerHTML = '';
        if (animales.length === 0) {
            tablaBody.innerHTML = `<tr><td colspan="7" class="text-center">No animals found.</td></tr>`;
            return;
        }
        animales.forEach(animal => {
            const fila = `
                <tr>
                    <td>${animal.id}</td>
                    <td>${animal.nombre}</td>
                    <td>${animal.fecha_nacimiento ? animal.fecha_nacimiento.split('T')[0] : 'N/A'}</td>
                    <td>${obtenerNombrePorId(animal.cuidador_id, cuidadoresData)}</td>
                    <td>${obtenerNombrePorId(animal.habitat_id, habitatsData)}</td>
                    <td>${obtenerNombrePorId(animal.especie_id, especiesData)}</td>
                    <td>
                        <button class="btn btn-sm btn-outline-primary btn-action btn-edit" title="Edit"
                            data-id="${animal.id}" data-nombre="${animal.nombre}" data-fecha_nacimiento="${animal.fecha_nacimiento.split('T')[0]}"
                            data-cuidador_id="${animal.cuidador_id}" data-habitat_id="${animal.habitat_id}" data-especie_id="${animal.especie_id}">
                            <i class="bi bi-pencil-square"></i>
                        </button>
                        <button class="btn btn-sm btn-outline-danger btn-action btn-delete" title="Delete"
                            data-id="${animal.id}" data-nombre="${animal.nombre}">
                            <i class="bi bi-trash"></i>
                        </button>
                    </td>
                </tr>`;
            tablaBody.innerHTML += fila;
        });
    }

    function actualizarContadorResultados(cantidad, isSearch) {
        const contador = document.getElementById('contadorResultados');
        if (isSearch) {
            contador.textContent = `${cantidad} ${translations[currentLang]['results-found']}`;
        } else {
            contador.textContent = `${cantidad} ${translations[currentLang]['total-animals']}`;
        }
    }

    function renderPaginacion() {
        const paginacionDiv = document.getElementById('paginacionAnimales');
        if (totalPaginas <= 1) {
            paginacionDiv.innerHTML = '';
            return;
        }
        let paginacionHTML = `<nav class="mt-4"><ul class="pagination justify-content-center">`;
        paginacionHTML += `<li class="page-item ${paginaActual === 1 ? 'disabled' : ''}"><a class="page-link" href="#" onclick="cambiarPagina(${paginaActual - 1})">«</a></li>`;
        for (let i = 1; i <= totalPaginas; i++) {
            paginacionHTML += `<li class="page-item ${paginaActual === i ? 'active' : ''}"><a class="page-link" href="#" onclick="cambiarPagina(${i})">${i}</a></li>`;
        }
        paginacionHTML += `<li class="page-item ${paginaActual === totalPaginas ? 'disabled' : ''}"><a class="page-link" href="#" onclick="cambiarPagina(${paginaActual + 1})">»</a></li>`;
        paginacionHTML += `</ul></nav>`;
        paginacionDiv.innerHTML = paginacionHTML;
    }

    function cambiarPagina(nuevaPagina) {
        paginaActual = nuevaPagina;
        filtrarAnimales();
    }

    // --- Event Listeners & Initializers ---
    document.addEventListener('DOMContentLoaded', async function() {
        // Theme initialization
        if (localStorage.getItem('theme') === 'dark') {
            document.body.classList.add('dark-mode');
            document.getElementById('themeIcon').classList.replace('bi-moon-stars-fill', 'bi-sun-fill');
        } else {
             document.getElementById('themeIcon').classList.replace('bi-sun-fill', 'bi-moon-stars-fill');
        }

        await cargarDatosReferencia();
        refrescarTablaAnimales();
        updateLanguage(); // Initial language set

        // Event Listeners
        document.getElementById('toggleLanguage').addEventListener('click', () => {
            currentLang = currentLang === 'en' ? 'es' : 'en';
            updateLanguage();
        });
        document.getElementById('toggleTheme').addEventListener('click', toggleTheme);

        // Modals opening
        document.getElementById('modalRegistrarAnimal').addEventListener('show.bs.modal', () => {
            populateSelect('cuidadorAnimal', cuidadoresData, 'select-keeper');
            populateSelect('habitatAnimal', habitatsData, 'select-habitat');
            populateSelect('especieAnimal', especiesData, 'select-species');
        });

        // Forms submission
        document.getElementById('formRegistrarAnimal').addEventListener('submit', handleRegister);
        document.getElementById('formActualizarAnimal').addEventListener('submit', handleUpdate);
        document.getElementById('btnConfirmarEliminar').addEventListener('click', handleDelete);
        
        // Table action buttons (Event Delegation)
        document.getElementById('tablaAnimales').querySelector('tbody').addEventListener('click', e => {
            const btn = e.target.closest('.btn-action');
            if (!btn) return;
            
            const { id, nombre } = btn.dataset;
            if (btn.classList.contains('btn-edit')) {
                abrirModalActualizar(btn.dataset);
            } else if (btn.classList.contains('btn-delete')) {
                abrirModalEliminar(id, nombre);
            }
        });
    });

    // --- Form Handlers ---
    async function handleRegister(e) {
        e.preventDefault();
        const data = {
            nombre: document.getElementById('nombreAnimal').value,
            fecha_nacimiento: document.getElementById('fechaNacimientoAnimal').value,
            cuidador_id: parseInt(document.getElementById('cuidadorAnimal').value) || null,
            habitat_id: parseInt(document.getElementById('habitatAnimal').value) || null,
            especie_id: parseInt(document.getElementById('especieAnimal').value) || null
        };
        try {
            const response = await fetch(`${API_BASE_URL}/animales`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });
            if (!response.ok) throw new Error('Registration failed');
            showMessage('mensajeRegistrarAnimal', 'Animal registered successfully!', 'success');
            refrescarTablaAnimales();
            e.target.reset();
            setTimeout(() => bootstrap.Modal.getInstance(document.getElementById('modalRegistrarAnimal')).hide(), 1500);
        } catch(err) {
            showMessage('mensajeRegistrarAnimal', 'Error registering animal.', 'danger');
        }
    }

    function abrirModalActualizar(dataset) {
        document.getElementById('idActualizarAnimal').value = dataset.id;
        document.getElementById('nombreActualizarAnimal').value = dataset.nombre;
        document.getElementById('fechaActualizarNacimientoAnimal').value = dataset.fecha_nacimiento;
        
        populateSelect('cuidadorActualizarAnimal', cuidadoresData, 'select-keeper');
        populateSelect('habitatActualizarAnimal', habitatsData, 'select-habitat');
        populateSelect('especieActualizarAnimal', especiesData, 'select-species');

        document.getElementById('cuidadorActualizarAnimal').value = dataset.cuidador_id;
        document.getElementById('habitatActualizarAnimal').value = dataset.habitat_id;
        document.getElementById('especieActualizarAnimal').value = dataset.especie_id;
        
        bootstrap.Modal.getOrCreateInstance(document.getElementById('modalActualizarAnimal')).show();
    }

    async function handleUpdate(e) {
        e.preventDefault();
        const id = document.getElementById('idActualizarAnimal').value;
        const data = {
            nombre: document.getElementById('nombreActualizarAnimal').value,
            fecha_nacimiento: document.getElementById('fechaActualizarNacimientoAnimal').value,
            cuidador_id: parseInt(document.getElementById('cuidadorActualizarAnimal').value) || null,
            habitat_id: parseInt(document.getElementById('habitatActualizarAnimal').value) || null,
            especie_id: parseInt(document.getElementById('especieActualizarAnimal').value) || null
        };
        try {
            const response = await fetch(`${API_BASE_URL}/animales/${id}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });
            if (!response.ok) throw new Error('Update failed');
            showMessage('mensajeActualizarAnimal', 'Animal updated successfully!', 'success');
            refrescarTablaAnimales();
            setTimeout(() => bootstrap.Modal.getInstance(document.getElementById('modalActualizarAnimal')).hide(), 1500);
        } catch (err) {
            showMessage('mensajeActualizarAnimal', 'Error updating animal.', 'danger');
        }
    }
    
    function abrirModalEliminar(id, nombre) {
        const modal = bootstrap.Modal.getOrCreateInstance(document.getElementById('modalEliminarAnimal'));
        document.getElementById('confirmarEliminarTexto').textContent = `${translations[currentLang]['delete-confirm-text']} ${nombre}?`;
        document.getElementById('btnConfirmarEliminar').dataset.id = id;
        modal.show();
    }

    async function handleDelete(e) {
        const id = e.target.dataset.id;
        try {
            const response = await fetch(`${API_BASE_URL}/animales/${id}`, { method: 'DELETE' });
            if (!response.ok) throw new Error('Deletion failed');
            showMessage('mensajeEliminarAnimal', 'Animal deleted successfully!', 'success');
            refrescarTablaAnimales();
            setTimeout(() => bootstrap.Modal.getInstance(document.getElementById('modalEliminarAnimal')).hide(), 1500);
        } catch (err) {
            showMessage('mensajeEliminarAnimal', 'Error deleting animal.', 'danger');
        }
    }
    </script>
</body>
</html>